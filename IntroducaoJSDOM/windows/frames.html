<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Frames Avan√ßado - JavaScript Window Object</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        
        h1 {
            color: #333;
            border-bottom: 3px solid #007bff;
            padding-bottom: 15px;
            margin-bottom: 30px;
        }
        
        .section {
            margin: 25px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #fafafa;
        }
        
        .button-group {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 15px 0;
        }
        
        button {
            background: linear-gradient(45deg, #007bff, #0056b3);
            color: white;
            border: none;
            padding: 12px 18px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,123,255,0.3);
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,123,255,0.4);
        }
        
        button.success { background: linear-gradient(45deg, #28a745, #20c997); }
        button.danger { background: linear-gradient(45deg, #dc3545, #e74c3c); }
        button.warning { background: linear-gradient(45deg, #ffc107, #ff8c00); }
        
        #output {
            background: #1e1e1e;
            color: #00ff00;
            border: 1px solid #333;
            padding: 20px;
            margin-top: 20px;
            border-radius: 10px;
            min-height: 200px;
            font-family: 'Courier New', monospace;
            overflow-y: auto;
            max-height: 400px;
        }
        
        .frame-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        iframe {
            border: 3px solid #007bff;
            border-radius: 10px;
            width: 100%;
            height: 200px;
            transition: all 0.3s ease;
        }
        
        iframe:hover {
            border-color: #28a745;
            transform: scale(1.02);
        }
        
        .frame-info {
            background: #e9ecef;
            padding: 10px;
            border-radius: 5px;
            margin-top: 10px;
            font-size: 12px;
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .stat-card {
            background: linear-gradient(45deg, #f8f9fa, #e9ecef);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            border: 2px solid #dee2e6;
        }
        
        .stat-number {
            font-size: 2em;
            font-weight: bold;
            color: #007bff;
        }
        
        .communication-panel {
            background: #fff3cd;
            border: 2px solid #ffc107;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .message-log {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 15px;
            margin: 10px 0;
            max-height: 150px;
            overflow-y: auto;
        }
        
        .code-example {
            background: #2d3748;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üñºÔ∏è Frames Avan√ßado - window.frames[]</h1>
        
        <div class="stats">
            <div class="stat-card">
                <div class="stat-number" id="frameCount">0</div>
                <div>Total de Frames</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="messageCount">0</div>
                <div>Mensagens Enviadas</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="operationCount">0</div>
                <div>Opera√ß√µes Realizadas</div>
            </div>
        </div>

        <div class="section">
            <h2>üìù Conceito</h2>
            <p>O array <code>window.frames[]</code> cont√©m refer√™ncias para todos os frames (iframes) presentes na p√°gina atual. Cada frame √© uma janela separada que pode conter seu pr√≥prio documento HTML.</p>
        </div>

        <div class="section">
            <h2>üéÆ Controles B√°sicos</h2>
            <div class="button-group">
                <button onclick="contarFrames()">üìä Contar Frames</button>
                <button onclick="listarFrames()">üìã Listar Frames</button>
                <button onclick="analisarFrames()">üîç An√°lise Detalhada</button>
                <button class="success" onclick="adicionarFrame()">‚ûï Adicionar Frame</button>
                <button class="danger" onclick="removerFrame()">‚ùå Remover Frame</button>
                <button class="warning" onclick="limparTodos()">üóëÔ∏è Limpar Todos</button>
            </div>
        </div>

        <div class="section">
            <h2>üí¨ Sistema de Comunica√ß√£o</h2>
            <div class="communication-panel">
                <div class="button-group">
                    <button onclick="enviarMensagemSimples()">üì§ Mensagem Simples</button>
                    <button onclick="enviarComando()">‚ö° Enviar Comando</button>
                    <button onclick="solicitarInfo()">‚ùì Solicitar Info</button>
                    <button onclick="broadcastMensagem()">üì° Broadcast</button>
                </div>
                <div class="message-log" id="messageLog">
                    <p><em>Log de mensagens aparecer√° aqui...</em></p>
                </div>
            </div>
        </div>

        <div class="section">
            <h2>üñºÔ∏è Frames Ativos</h2>
            <div class="frame-container" id="frameContainer">
                <!-- Frames ser√£o adicionados dinamicamente aqui -->
            </div>
        </div>

        <div class="section">
            <h2>üíª C√≥digo JavaScript</h2>
            <div class="code-example">
                <pre><code>// Contar n√∫mero de frames
function contarFrames() {
    const quantidade = window.frames.length;
    console.log('N√∫mero de frames:', quantidade);
}

// Listar todos os frames
function listarFrames() {
    for (let i = 0; i &lt; window.frames.length; i++) {
        console.log('Frame', i, ':', window.frames[i]);
    }
}

// Comunica√ß√£o via postMessage (evita problemas cross-origin)
function enviarMensagem() {
    window.frames[0].postMessage('Ol√° do parent!', '*');
}</code></pre>
            </div>
        </div>

        <div id="output">
            <div style="color: #00ff41; font-weight: bold;">üñ•Ô∏è CONSOLE DE SA√çDA - SISTEMA DE FRAMES</div>
            <div style="color: #888;">============================================</div>
        </div>
    </div>

    <script>
        // Vari√°veis globais
        let frameCounter = 0;
        let messageCounter = 0;
        let operationCounter = 0;

        // Sistema de log melhorado
        function adicionarSaida(mensagem, tipo) {
            const output = document.getElementById('output');
            const timestamp = new Date().toLocaleTimeString();
            
            let cor = '#00ff00';
            let icone = 'üìã';
            
            if (tipo === 'success') { cor = '#00ff41'; icone = '‚úÖ'; }
            else if (tipo === 'error') { cor = '#ff4444'; icone = '‚ùå'; }
            else if (tipo === 'warning') { cor = '#ffaa00'; icone = '‚ö†Ô∏è'; }
            else if (tipo === 'info') { cor = '#00aaff'; icone = 'üí°'; }
            
            const div = document.createElement('div');
            div.innerHTML = '<span style="color: #888">[' + timestamp + ']</span> <span style="color: ' + cor + '">' + icone + ' ' + mensagem + '</span>';
            output.appendChild(div);
            output.scrollTop = output.scrollHeight;
            
            console.log(icone + ' ' + mensagem);
            operationCounter++;
            atualizarStats();
        }

        // Atualizar estat√≠sticas
        function atualizarStats() {
            document.getElementById('frameCount').textContent = window.frames.length;
            document.getElementById('messageCount').textContent = messageCounter;
            document.getElementById('operationCount').textContent = operationCounter;
        }

        // Gerar conte√∫do HTML minificado para frames
        function gerarConteudoFrame(numero) {
            var html = '<!DOCTYPE html><html><head>';
            html += '<style>body{font-family:Arial;margin:15px;background:linear-gradient(45deg,#e3f2fd,#f3e5f5);border-radius:10px;padding:20px;text-align:center}';
            html += '.header{background:#007bff;color:white;padding:10px;border-radius:5px;margin-bottom:15px}';
            html += 'button{background:#28a745;color:white;border:none;padding:8px 15px;border-radius:5px;cursor:pointer;margin:5px}';
            html += '.info{background:#f8f9fa;border:1px solid #dee2e6;border-radius:5px;padding:10px;margin:10px 0}</style>';
            html += '</head><body>';
            html += '<div class="header"><h3>üñºÔ∏è Frame ' + numero + '</h3></div>';
            html += '<div class="info"><strong>ID:</strong> frame-' + numero + '<br>';
            html += '<strong>Criado:</strong> ' + new Date().toLocaleString() + '<br>';
            html += '<strong>Status:</strong> <span style="color:green">‚óè</span> Ativo</div>';
            html += '<button onclick="responderParent(\'Ol√° do Frame ' + numero + '!\')">üì§ Responder</button>';
            html += '<button onclick="window.parent.adicionarSaida(\'Frame ' + numero + ' clicado!\', \'success\')">üîî Notificar</button>';
            html += '<script>';
            html += 'window.addEventListener("message", function(event) {';
            html += 'console.log("Frame ' + numero + ' recebeu:", event.data);';
            html += 'if (event.data.comando) {';
            html += 'if (event.data.comando === "ping") responderParent("pong do Frame ' + numero + '");';
            html += 'if (event.data.comando === "info") responderParent({frame:' + numero + ',timestamp:new Date().toISOString()});';
            html += '}});';
            html += 'function responderParent(msg) {';
            html += 'window.parent.postMessage({origem:"frame-' + numero + '", mensagem:msg, timestamp:new Date().toISOString()}, "*");';
            html += '}';
            html += 'window.onload = function() { responderParent("Frame ' + numero + ' carregado!"); };';
            html += '<\/script></body></html>';
            return html;
        }

        // Funcionalidades principais
        function contarFrames() {
            const quantidade = window.frames.length;
            adicionarSaida('N√∫mero total de frames: ' + quantidade, 'info');
        }

        function listarFrames() {
            adicionarSaida('Listando todos os frames:', 'info');
            
            for (let i = 0; i < window.frames.length; i++) {
                const frameElement = document.getElementsByTagName('iframe')[i];
                const frameName = frameElement.name || frameElement.id || 'frame-' + i;
                
                adicionarSaida('  üìé Frame ' + i + ': ' + frameName, 'info');
                
                try {
                    adicionarSaida('     üìç Origem: Mesma origem (srcdoc)', 'success');
                } catch (error) {
                    adicionarSaida('     üìç Erro de acesso: ' + error.message, 'error');
                }
            }
        }

        function analisarFrames() {
            adicionarSaida('Iniciando an√°lise detalhada dos frames...', 'info');
            
            const iframes = document.getElementsByTagName('iframe');
            
            for (let i = 0; i < iframes.length; i++) {
                const iframe = iframes[i];
                
                adicionarSaida('üîç Analisando Frame ' + i + ':', 'info');
                adicionarSaida('   üìã ID: ' + iframe.id, 'info');
                adicionarSaida('   üìã Name: ' + iframe.name, 'info');
                adicionarSaida('   üìê Dimens√µes: ' + iframe.offsetWidth + 'x' + iframe.offsetHeight, 'info');
                adicionarSaida('   üîó Tipo: srcdoc (conte√∫do inline)', 'info');
            }
        }

        function adicionarFrame() {
            frameCounter++;
            const container = document.getElementById('frameContainer');
            
            const frameWrapper = document.createElement('div');
            const iframe = document.createElement('iframe');
            iframe.id = 'frame-' + frameCounter;
            iframe.name = 'frame-' + frameCounter;
            iframe.srcdoc = gerarConteudoFrame(frameCounter);
            
            const frameInfo = document.createElement('div');
            frameInfo.className = 'frame-info';
            frameInfo.innerHTML = '<strong>Frame ID:</strong> frame-' + frameCounter + ' | <strong>Criado:</strong> ' + new Date().toLocaleTimeString();
            
            frameWrapper.appendChild(iframe);
            frameWrapper.appendChild(frameInfo);
            container.appendChild(frameWrapper);
            
            adicionarSaida('Novo frame adicionado: frame-' + frameCounter, 'success');
            
            setTimeout(function() {
                contarFrames();
            }, 200);
        }

        function removerFrame() {
            const container = document.getElementById('frameContainer');
            
            if (container.children.length === 0) {
                adicionarSaida('Nenhum frame dispon√≠vel para remo√ß√£o!', 'warning');
                return;
            }
            
            container.removeChild(container.lastElementChild);
            adicionarSaida('√öltimo frame removido com sucesso', 'success');
            
            setTimeout(function() {
                contarFrames();
            }, 100);
        }

        function limparTodos() {
            const container = document.getElementById('frameContainer');
            container.innerHTML = '';
            frameCounter = 0;
            
            adicionarSaida('Todos os frames foram removidos', 'warning');
            contarFrames();
        }

        // Sistema de comunica√ß√£o
        function enviarMensagemSimples() {
            if (window.frames.length === 0) {
                adicionarSaida('Nenhum frame dispon√≠vel para comunica√ß√£o!', 'error');
                return;
            }
            
            const mensagem = 'Ol√° dos frames! Timestamp: ' + new Date().toLocaleTimeString();
            
            for (let i = 0; i < window.frames.length; i++) {
                window.frames[i].postMessage(mensagem, '*');
            }
            
            messageCounter++;
            adicionarSaida('Mensagem simples enviada para ' + window.frames.length + ' frame(s)', 'success');
        }

        function enviarComando() {
            if (window.frames.length === 0) {
                adicionarSaida('Nenhum frame dispon√≠vel!', 'error');
                return;
            }
            
            const comando = { comando: 'ping', timestamp: new Date().toISOString() };
            
            window.frames[0].postMessage(comando, '*');
            messageCounter++;
            adicionarSaida('Comando ping enviado para o primeiro frame', 'success');
        }

        function solicitarInfo() {
            if (window.frames.length === 0) {
                adicionarSaida('Nenhum frame dispon√≠vel!', 'error');
                return;
            }
            
            for (let i = 0; i < window.frames.length; i++) {
                window.frames[i].postMessage({ comando: 'info' }, '*');
            }
            
            messageCounter++;
            adicionarSaida('Solicita√ß√£o de informa√ß√µes enviada para todos os frames', 'info');
        }

        function broadcastMensagem() {
            if (window.frames.length === 0) {
                adicionarSaida('Nenhum frame dispon√≠vel!', 'error');
                return;
            }
            
            const broadcast = {
                tipo: 'broadcast',
                mensagem: 'Mensagem em broadcast para todos os frames!',
                origem: 'parent-window',
                timestamp: new Date().toISOString()
            };
            
            for (let i = 0; i < window.frames.length; i++) {
                window.frames[i].postMessage(broadcast, '*');
            }
            
            messageCounter++;
            adicionarSaida('Broadcast enviado para ' + window.frames.length + ' frame(s)', 'success');
        }

        // Listener para mensagens dos frames
        window.addEventListener('message', function(event) {
            const messageLog = document.getElementById('messageLog');
            
            const messageDiv = document.createElement('div');
            messageDiv.innerHTML = '<strong>[' + new Date().toLocaleTimeString() + ']</strong> <span style="color: #007bff">' + (event.data.origem || 'Frame') + ':</span> ' + (typeof event.data.mensagem === 'object' ? JSON.stringify(event.data.mensagem, null, 2) : event.data.mensagem || event.data);
            messageDiv.style.borderBottom = '1px solid #dee2e6';
            messageDiv.style.padding = '5px 0';
            
            messageLog.appendChild(messageDiv);
            messageLog.scrollTop = messageLog.scrollHeight;
            
            adicionarSaida('Mensagem recebida: ' + (event.data.mensagem || event.data), 'success');
        });

        // Monitoramento autom√°tico
        let lastFrameCount = 0;
        setInterval(function() {
            if (window.frames.length !== lastFrameCount) {
                lastFrameCount = window.frames.length;
                atualizarStats();
            }
        }, 500);

        // Inicializa√ß√£o
        window.onload = function() {
            adicionarSaida('üöÄ Sistema de Frames Avan√ßado iniciado!', 'success');
            adicionarSaida('üí° Dica: Clique em "Adicionar Frame" para come√ßar', 'info');
            adicionarSaida('‚úÖ Problemas de cross-origin resolvidos com srcdoc', 'success');
            atualizarStats();
        };
    </script>
</body>
</html>